{"version":3,"sources":["../src/connection.js"],"names":["Connection","connOpts","handler","log","conn","readline","input","output","onMessage","str","msg","debug","on","e","error","close","end","send","write"],"mappings":";;;;;kBAIwBA,U;;AAJxB;;AACA;;AACA;;AAEe,SAASA,UAAT,CAAoBC,QAApB,EAA8BC,OAA9B,EAAuCC,GAAvC,EAA4C;AACzD,QAAMC,OAAO,kBAAQH,QAAR,CAAb;AACA,QAAMI,WAAW,+BAAgB,EAAEC,OAAOF,IAAT,EAAeG,QAAQH,IAAvB,EAAhB,CAAjB;;AAEA,WAASI,SAAT,CAAmBC,GAAnB,EAAwB;AACtB,UAAMC,MAAM,oBAAMD,GAAN,CAAZ;AACAN,QAAIQ,KAAJ,CAAU,GAAV,EAAeD,GAAf;AACAR,YAAQQ,GAAR;AACD;;AAEDN,OAAKQ,EAAL,CAAQ,SAAR,EAAmB,MAAM;AACvBT,QAAIQ,KAAJ,CAAU,gBAAV;AACD,GAFD;;AAIAP,OAAKQ,EAAL,CAAQ,OAAR,EAAkBC,CAAD,IAAO;AACtBV,QAAIW,KAAJ,CAAU,uBAAV,EAAmCD,CAAnC;AACD,GAFD;;AAIAT,OAAKQ,EAAL,CAAQ,OAAR,EAAiB,MAAM;AACrBT,QAAIQ,KAAJ,CAAU,wBAAV;AACD,GAFD;;AAIAN,WAASO,EAAT,CAAY,MAAZ,EAAoBJ,SAApB;;AAEA,WAASO,KAAT,GAAiB;AACfX,SAAKY,GAAL;AACD;;AAED,WAASC,IAAT,CAAcP,GAAd,EAAmB;AACjBP,QAAIQ,KAAJ,CAAU,GAAV,EAAeD,GAAf;AACAN,SAAKc,KAAL,CAAY,IAAE,wBAAUR,GAAV,CAAe,KAA7B;AACD;;AAED,SAAO,EAAEK,KAAF,EAASE,IAAT,EAAP;AACD","file":"connection.js","sourcesContent":["import { connect } from 'net';\nimport { createInterface } from 'readline';\nimport { serialize, parse } from './message';\n\nexport default function Connection(connOpts, handler, log) {\n  const conn = connect(connOpts);\n  const readline = createInterface({ input: conn, output: conn });\n\n  function onMessage(str) {\n    const msg = parse(str);\n    log.debug('>', msg);\n    handler(msg);\n  }\n\n  conn.on('connect', () => {\n    log.debug('Yate connected');\n  });\n\n  conn.on('error', (e) => {\n    log.error('Yate connection error', e);\n  });\n\n  conn.on('close', () => {\n    log.debug('Yate connection closed');\n  });\n\n  readline.on('line', onMessage);\n\n  function close() {\n    conn.end();\n  }\n\n  function send(msg) {\n    log.debug('<', msg);\n    conn.write(`${serialize(msg)}\\n`);\n  }\n\n  return { close, send };\n}\n"]}